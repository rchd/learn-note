* postgresql
  
** 编译
   执行如下命令即可编译安装
   #+begin_src sh
     ./configure -prefix=/usr/local/pgsql && make && make install 
   #+end_src
   即可编译安装
   #+begin_src sh
     export PATH=$PATH:/usr/local/pgsql/bin
     adduser postgres && su - postgres

     initdb -D /var/db/pgsql

     pg_ctl -D /var/db/pgsql -l logfile start
   #+end_src

   启用调试
   #+begin_src sh
     ./configure --enable-debug
   #+end_src
   接着安装即可

   #+begin_src sh
     psql
     select pg_backend_pid(); # 输出进行连接的线程
     gdb attach [thread-id]       
   #+end_src

   打上断点，使用dir命令设置源码目录，即可开始调试

** postgresql相关的命令行工具
   客户端应用
   | 命令           | 说明                                                  |
   |----------------+-------------------------------------------------------|
   | clusterdb      | 聚簇一个PostgreSQL数据库                              |
   | createdb       | 创建一个新的PostgreSQL数据库                          |
   | createuser     | 定义一个新的PostgreSQL用户账户                        |
   | dropdb         | 移除一个PostgreSQL数据库                              |
   | dropuser       | 移除一个PostgresSQL用户账户                           |
   | ecpg           | 嵌入式C预处理器                                       |
   | pg_basebackup  | 获得一个PostgreSQL集簇的一个基础备份                  |
   | pgbench        | 在PostgreSQL运行一个基准测试                          |
   | pg_config      | 获取已安装的PostgreSQL的信息                          |
   | pg_dump        | 把PostgreSQL数据库抽取为一个脚本文件或其他归档文件    |
   | pg_dumpall     | 将一个PostgreSQL数据集簇抽取到一个脚本文件中          |
   | pg_isready     | 检测一个PostgreSQL服务器的连接状态                    |
   | pg_receivewal  | 以流的方式从一个PostgreSQL服务器得到预写式日志        |
   | pg_recvlogical | 控制PostgreSQL逻辑解码流                              |
   | pg_restore     | 从一个由pg_dump创建的归档文件恢复一个PostgreSQL数据库 |
   | psql           | PostgreSQL的交互式终端                                |
   | reindexdb      | 重索引一个PostgreSQL数据库                            |
   | vacuumdb       | 对一个PostgreSQL数据库进行垃圾收集和分析              |


   服务器应用
   | 命令             | 说明                                                             |
   |------------------+------------------------------------------------------------------|
   | initdb           | 创建一个新的postgresql数据库集簇                                 |
   | pg_achivecleanup | 清理PostgreSQL WAL归档文件                                       |
   | pg_checksums     | 在PostgreSQL数据库集簇中启用，禁用或检查数据校验和               |
   | pg_controldata   | 显示一个PostgreSQL数据库集簇的控制信息                           |
   | pg_ctl           | 初始化，启动，停止或控制一个PostgreSQL服务器                     |
   | pg_resetwal      | 重置一个PostgreSQL数据库集簇的预写式日志以及控制信息             |
   | pg_rewind        | 把一个PostgreSQL数据目录与另一个从该目录中复制出来的数据目录同步 |
   | pg_test_fsync    | 为PostgreSQL判断最快的wal_sync_method                            |
   | pg_test_timing   | 度量计时开销                                                     |
   | pg_upgrade       | 升级PostgreSQL服务器实例                                         |
   | pg_waldump       | 以及人类可读的形式显示一个PostgreSQL数据库集簇的预写式日志       |
   | postgres         | PostgreSQL数据库服务器                                           |
   | postmaster       | PostgreSQL数据库服务器                                           |

** 源码目录分析
   主要代码位于src/backend/目录下，src/include则包含相关定义信息，src/bin包含postgres的相关工具
   | 目录       | 说明                                                                        |
   |------------+-----------------------------------------------------------------------------|
   | bootstrap  | 创建初的模板数据库                                                          |
   | main       | 主程序模块，负责将控制权转到Postmaster进程或Postgres进程                    |
   | postmaster | 监听用户请求的守护进程，并控制Postgres进程的启动和终止                      |
   | libpq      | C/C++的库函数，处理与客户端间的通信                                         |
   | tcop       | Postgres服务进程的主要部分，调用parser,optimizer, executor,commands 执行SQL |
   | parser     | 语法分析，将SQL查询转化为内部查询树                                         |
   | optimizer  | 优化器，根据查询树创建最优的查询路径和查询计划                              |
   | executor   | 执行器，执行来自optimizer的查询计划                                         |
   | commands   | 执行非计划查询的SQL命令                                                     |
   | catalog    | 系统表操作，包含用于操作系统表的专用函数                                    |
   | storage    | 管理各种类型的存储系统                                                      |
   | access     | 提供各种存取方法，支持堆，索引等对数据的存取                                |
   | nodes      | 定义系统内部所用到的节点，链表等结构，以及处理这些结构的函数                |
   | utils      | 各种支持函数，如错误报告，各种初始化操作                                    |
   | regex      | 正则表达式库及相关函数，用于支持正则表达式处理                              |
   | rewrite    | 查询重写，根据规则系统对查询进行重写                                        |
   | tsearch    | 全文索引，倒排索引                                                          |
   | port       | 平台兼容性处理相关的函数我                                                  |

  
*** postgresql数据库目录
    | 文件                 | 描述                               |
    |----------------------+------------------------------------|
    | PG_VERSION           | 包含PostgreSQL主版本号             |
    | pg_hba.conf          | 控制PostgreSQL客户端认证           |
    | pg_indent.conf       | 控制PostgreSQL用户名映射           |
    | postgresql.conf      | 保存数据库相关的配置参数           |
    | postgresql.auto.conf | 存储使用ALTER SYSTEM修改的配置参数 |
    | postmaster.opts      | 记录服务器上次启动的命令行选项     |
    | base/                | 每个数据库对应的子目录都存储在些   |
    | global/              | 数据库集簇范畴的表                 |
    | pg_commit_ts/        | 事务提交的时间戳数据               |
    | pg_clog/             | 事务提交状态数据                   |
    | pg_dynshmem/         | 动态共享内存子系统中使用的文件     |
    | pg_logical/          | 逻辑解码的状态数据                 |
    | pg_multixact/        | 多事务状态数据                     |
    | pg_notify/           | LISTEN/NOTIFY状态数据              |
    | pg_repslot/          | 复制槽数据                         |
    | pg_serial/           | 已提交的可串行化事务相关信息       |
    | pg_snapshots/        | 导出快照                           |
    | pg_stat/             | 统计子系统的永久文件               |
    | pg_stat_tmp/         | 统计子系统的临时文件               |
    | pg_subtrans/         | 子事务状态数据                     |
    | pg_tblspc/           | 指向表空间的符号链接               |
    | pg_twophase/         | 两阶段事务的状态文件               |
    | pg_wal/              | WAL段文件                          |

*** 进程管理
    | 进程                 | 描述                                                        |
    |----------------------+-------------------------------------------------------------|
    | background writer    | 进程将shared buffer pool 中的脏数据写到磁盘，检查点总能触发 |
    | checkpointer         | 检查点会触发产生这个进程                                    |
    | autovacuum launcher  | 为vacuum process周期性的调用autovacuum work process         |
    | wal writer           | 周期性的从wal buffer刷新数据到磁盘                          |
    | statistics collector | 收集统计信息进程                                            |
    | logging collector    | 将错误信息写入到日志                                        |
    | archiver             | 将日志归档的进程                                            |

** 系统表
   | 表名                    | 用途                                   |
   |-------------------------+----------------------------------------|
   | pg_aggregate            | 聚集函数                               |
   | pg_am                   | 关系访问方法                           |
   | pg_amop                 | 访问方法操作符                         |
   | pg_amproc               | 访问方法支持函数                       |
   | pg_ttrdef               | 列默认值                               |
   | pg_authid               | 表列(属性)                             |
   | pg_auth_members         | 认证标识符成员关系                     |
   | pg_cast                 | 转换(数据类型转换)                     |
   | pg_class                | 表，索引，序列，视图                   |
   | pg_collation            | 排序规则                               |
   | pg_constraint           | 检查约束，唯一约束，主键约束，外键约束 |
   | pg_conversion           | 编码转换信息                           |
   | pg_database             | 本数据库集簇中数据库                   |
   | pg_db_role_setting      | 每角色和每数据库中的设置               |
   | pg_default_acl          | 对象精工的默认权限                     |
   | pg_depend               | 数据库对象间的依赖                     |
   | pg_description          | 数据库对象上的描述或注释               |
   | pg_enum                 | 枚举标签和值定义                       |
   | pg_event_trigger        | 事件触发器                             |
   | pg_extension            | 已安装扩展                             |
   | pg_foreign_data_wrapper | 外部数据库包装器定义                   |
   | pg_foreign_server       | 外部服务器定义                         |
   | pg_foreign_table        | 外部表信息                             |
   | pg_index                | 索引信息                               |
   | pg_inherits             | 表继承层次                             |
   | pg_init_privs           | 对象初始特权                           |
   | pg_language             | 编写函数的语言                         |
   | pg_largeobject          | 大对象的数据页                         |
   | pg_largeobject_metadata | 大对象的元数据                         |
   | pg_namespace            | 模式                                   |
   | pg_opclass              | 访问方法操作符类                       |
   | pg_operator             | 操作符                                 |
   | pg_opfamily             | 访问方法操作符类                       |
   | pg_partitioned_table    | 表的分区键的信息                       |
   | pg_pltemplate           | 过程语言的模板数据                     |
   | pg_policy               | 行安全策略                             |
   | pg_proc                 | 函数和过程                             |
   | pg_publication          | 用于逻辑复制的发布                     |
   | pg_publication_rel      | 发布映射的关系                         |
   | pg_range                | 范围类型的信息                         |
   | pg_replication_origin   | 已注册的复制源                         |
   | pg_rewrite              | 查询重写规则                           |
   | pg_seclabel             | 数据库对象上的安全标签                 |
   | pg_sequence             | 有关序列的信息                         |
   | pg_shdepend             | 共享对象上依赖                         |
   | pg_shdescription        | 共享对象上的注释                       |
   | pg_shseclable           | 共享数据库对象上的安全标签             |
   | pg_statistic            | 规划器统计                             |
   | pg_statistic_ext        | 扩展的规划器统计信息                   |
   | pg_statistic_ext_data   | 扩展的规划器统计信息                   |
   | pg_subscription         | 逻辑复制订阅                           |
   | pg_subscription_rel     | 订阅的关系状态                         |
   | pg_tablespace           | 本数据库集簇内的表空间                 |
   | pg_transform            | 转换                                   |
   | pg_trigger              | 触发器                                 |
   | pg_ts_config            | 文本搜索配置                           |
   | pg_ts_config_map        | 文本搜索配置的记号映射                 |
   | pg_ts_dict              | 文本搜索字典                           |
   | pg_ts_parser            | 文本搜索分析器                         |
   | pg_ts_template          | 文本搜索模板                           |
   | pg_type                 | 数据类型                               |
   | pg_user_mapping         | 将用户映射到外部服务器                 |




** 系统视图
   | 视图名称                        | 用途                         |
   |---------------------------------+------------------------------|
   | pg_available_extensions         | 可用的扩展                   |
   | pg_available_extension_versions | 所有版本的扩展               |
   | pg_config                       | 编译时配置参数               |
   | pg_cursors                      | 打开的游标                   |
   | pg_file_settings                | 配置文件内容摘本             |
   | pg_group                        | 数据库用户组                 |
   | pg_hba_file_rules               | 客户端认证配置文件内容的摘要 |
   | pg_indexes                      | 索引                         |
   | pg_locks                        | 当前保持或者等待的锁         |
   | pg_matviews                     | 物化视图                     |
   | pg_policies                     | 策略                         |
   | pg_prepared_statements          | 预备好的语句                 |
   | pg_prepared_xacts               | 预备好的事务                 |
   | pg_publication_tables           | publication和它们相关的表    |
   | pg_replication_origin_status    | 复制槽信息                   |
   | pg_roles                        | 数据库角色                   |
   | pg_rules                        | 规则                         |
   | pg_seclabels                    | 安全标签                     |
   | pg_sequences                    | 序列                         |
   | pg_settings                     | 参数设置                     |
   | pg_shadow                       | 数据库用户                   |
   | pg_stats                        | 规划器统计信息               |
   | pg_stat_ext                     | 扩展的计划器统计信息         |
   | pg_tables                       | 表格                         |
   | pg_timezone_abbrevs             | 时区简写                     |
   | pg_timezone_names               | 时区名字                     |
   | pg_user                         | 数据库用户                   |
   | pg_user_mappings                | 用户映射                     |
   | pg_views                        | 视图                         |

** 数据库临控视图
   动态统计视图
   | 视图名称                      | 说明                                                                  |
   |-------------------------------+-----------------------------------------------------------------------|
   | pg_stat_activity              | 每个服务器进程一行，显示与那个进程的当前活动相关信息                  |
   | pg_stat_replication           | 每个WAL发送进程一个，显示关到该发送进程连接的后备服务器的复制统计信息 |
   | pg_stat_wal_receiver          | 显示来自WAL接收器所连接服务器的有关该接收器的统计信息                 |
   | pg_stat_subscription          | 每个订阅至少一行，显示有关该订阅的工作者信息                          |
   | pg_stat_ssl                   | 每个连接一行，显示在这个连接上使用的SSL的信息                         |
   | pg_stat_gssapi                | 每个连接有一行，显示关于GSSAPI验证和加密的信息                        |
   | pg_stat_progress_analyze      | 显示每个ANALYZE的后端，显示当前的进度                                 |
   | pg_stat_progress_create_index | 每个后台运行create index或reindex的后端都有一个，显示当前的进度       |
   | pg_stat_progress_vacuum       | 每个运行VACUUM的后端一行，显示当前的进程                              |
   | pg_stat_progress_cluster      | 每个运行着CLUSTER或VACUUM FULL的后端一行，显示当前的进度              |
   | pg_stat_progress_basebackup   | 每个WAL发送者进程的行显示一个基础备份，显示当前进度                   |

   已收集统计信息的视图
   | 视图名称                    | 说明                                                                   |
   |-----------------------------+------------------------------------------------------------------------|
   | pg_stat_archiver            | 显示有关WAL归档进程活动的统计信息                                      |
   | pg_stat_bgwriter            | 显示有关后台进程的活动的统计信息                                       |
   | pg_stat_database            | 显示数据库范围的统计信息                                               |
   | pg_stat_database_conflicts  | 显示数据库范围的统计信息，与后备服务器的恢复过程发生冲突而被取消的查询 |
   | pg_stat_all_tables          | 当前数据库中的每个表，显示有关访问指定表的统计信息                     |
   | pg_stat_sys_tables          | 只显示系统表                                                           |
   | pg_stat_user_tables         | 只显示用户表                                                           |
   | pt_stat_xact_all_tables     | 计数动作只在当前事务内发生                                             |
   | pg_stat_xact_sys_tables     | 显示系统表的事务计数                                                   |
   | pg_stat_xact_user_tables    | 显示用户表的事务计数                                                   |
   | pg_stat_all_indexs          | 显示与访问指定索引有关的统计信息                                       |
   | pg_stat_sys_indexes         | 只显示系统表上的索引                                                   |
   | pg_stat_user_indexes        | 只显示用户表上的索引                                                   |
   | pg_statio_all_tables        | 显示有关在指定表上I/O的统计信息                                        |
   | pg_statio_sys_tables        | 只显示系统表                                                           |
   | pg_statio_user_tables       | 只显示用户表                                                           |
   | pg_statio_all_indexes       | 显示与指定索引上的I/O有关的统计信息                                    |
   | pg_statio_sys_indexes       | 只显示系统表上的索引                                                   |
   | pg_statio_user_indexes      | 只显示用户表的索引                                                     |
   | pg_statio_all_sequences     | 显示与指定列上的I/O有关的统计信息                                      |
   | pg_statio_sys_sequences     | 只显示系统序列                                                         |
   | pg_statio_user_seqences     | 只显示用户序列                                                         |
   | pg_stat_user_functions      | 显示与执行该函数有关的统计信息                                         |
   | pg_stat_xact_user_functinos | 只显示在当前事务的该函数的有关信息                                     |
   | pg_stat_slru                | 每个SLRU一行，显示操作的统计信息                                       |


** 额外提供的模块
   | 模块名             | 用途                                                       |
   |--------------------+------------------------------------------------------------|
   | adminpack          | 提供一些支持函数，例如服务器日志文件的远程管理等           |
   | amcheck            | 提供的函数让用户能难关系结构的一致性。                     |
   | auto_explain       | 自动记录慢速语句的查询执行计划                             |
   | bloom              | 布鲁姆过滤器索引                                           |
   | btree_gin          | 提供实现等价行为的GIN操作符                                |
   | btree_gist         | 提供实现等价行为的GiST索引的操作符                         |
   | citext             | 提供一种大小写不敏感的字符串类型                           |
   | cube               | 提供一种数据类型cube来表示多维立方体                       |
   | dblink             | 支持一个数据库会话中连接到其他PostgreSQL数据库的模块       |
   | dict_int           | 附加全文搜索词典模板，控制整数的索引                       |
   | dict_xsyn          | 将词替换为它们的同义词分组                                 |
   | earthdistance      | 提供两种不同的方法来计算地球表面的大圆距离                 |
   | file_fdw           | 提供外部数据包装器，用来访问服务器的文件系统中的数据       |
   | fuzzystrmatch      | 提供多个函数来判断字符之间的相似性和距离                   |
   | hstore             | 用来在一个单一PostgreSQL值中存储键值对                     |
   | intagg             | 提供一个整数聚集器以及一个枚举器                           |
   | intarray           | 提供了有用的函数操作符来操纵不含空值的整数数组             |
   | isn                | 为国际产品标准提供数据类型                                 |
   | lo                 | 提供管理大对象的支持，包含数据类型lo和触发器lo_manage      |
   | ltree              | 用于表示存储在一个层次树状结构中的数据的标签以及搜索功能   |
   | pageinspect        | 提供的函数可以从低层次观察数据库页面内容                   |
   | passwordcheck      | create或alter设置用户时，它会检查用户口令                  |
   | pg_buffercache     | 实时检查共享缓冲区                                         |
   | pgcrypto           | 提供了密码函数                                             |
   | pg_freespacemap    | 检查空闲空间映射，提供了pg_freespace函数                   |
   | pg_prewarm         | 将关系数据载入到操作系统缓冲区或者PostgreSQL缓冲区         |
   | pgrowlocks         | 提供一个函数显示一个指定表的行锁信息                       |
   | pg_stat_statements | 追踪服务器所执行的所有SQL语句的执行统计信息                |
   | pgstattuple        | 获得元组层的统计信息                                       |
   | pg_trgm            | 用于决定基于trigram匹配的字母数字文本相似度的函数和操作符  |
   | pg_visiblity       | 提供一种检查一个表的可见性映射以及页级别的可见性信息       |
   | postgres_fdw       | 用来访问存储在外部PostgreSQL服务器中数据                   |
   | seg                | 表示线段或浮点区间实现了一种数据类型seg                    |
   | sepgsql            | 基于SELinux安全策略的支持基于标签强制访问控制模块          |
   | spi                | 提供使用服务器编程接口和触发器的例子                       |
   | sslinfo            | 提供当前客户端提供的SSL证书的有关信息                      |
   | tablefunc          | 多个返回表的函数                                           |
   | tcn                | 提供一个触发器函数，通知监听者有关它所附着的任意表上的改变 |
   | test_decoding      | 一个逻辑解码输出插件的例子                                 |
   | tsm_system_rows    | 提供了表采样方法SYSTEM_ROWS                                |
   | tsm_system_time    | 提供了表采样方法SYSTEM_TIME                                |
   | unaccent           | 一个文本搜索字典，能从词位中移除重音                       |
   | uuid_ossp          | 产生通用唯一标识符                                         |
   | xml2               | 提供XPATH查询和XSLT功能                                                    |
   


